<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script>
      AFRAME.registerComponent('architect-filters', {
        schema: {
          color: {type: 'color', default: '#ffffff'},
          opacity: {type: 'number', default: 1.0}
        },
        init: function () {
          this.el.addEventListener('model-loaded', () => {
            const mesh = this.el.getObject3D('mesh');
            if (!mesh) return;
            mesh.traverse((node) => {
              if (node.isMesh) {
                node.material.transparent = true;
                node.material.opacity = this.data.opacity;
                node.material.color.set(this.data.color);
                // We add these two lines to make the material react better to the new light
                node.material.roughness = 0.7; 
                node.material.metalness = 0.2;
              }
            });
          });
        }
      });
    </script>
  </head>

  <body style="margin: 0px; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; smooth: true; smoothCount: 10; patternRatio: 0.7;">
      
      <a-entity light="type: ambient; intensity: 0.7; color: #ffffff;"></a-entity>
      
      <a-entity light="type: directional; intensity: 1.0; castShadow: true;" 
                position="1 4 2"></a-entity>

      <a-marker type="pattern" url="https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/pattern-opening.patt">
        <a-entity gltf-model="url(https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/window.glb)" 
                  scale="10 10 10" 
                  position="0 5 0" 
                  rotation="90 0 0"
                  architect-filters="color: #00ffff; opacity: 0.6"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/pattern-illum.patt">
        <a-entity gltf-model="url(https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/cone.glb)" 
                  scale="10 10 10" 
                  position="0 0 0"
                  architect-filters="color: #ffff00; opacity: 0.4"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/pattern-connect.patt">
        <a-entity gltf-model="url(https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/stair.glb)" 
                  scale="10 10 10" 
                  position="0 0 0" 
                  architect-filters="color: #008000; opacity: 0.8"></a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
