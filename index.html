<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <script>
    AFRAME.registerComponent('architect-filters', {
      schema: {
        color: {type: 'color', default: '#ffffff'},
        opacity: {type: 'number', default: 1.0}
      },
      init: function () {
        // Wait for the .glb model to fully load
        this.el.addEventListener('model-loaded', () => {
          const mesh = this.el.getObject3D('mesh');
          if (!mesh) return;

          // Drill down into the 3D geometry to apply changes
          mesh.traverse((node) => {
            if (node.isMesh) {
              node.material.transparent = true; // Required for opacity to work
              node.material.opacity = this.data.opacity;
              node.material.color.set(this.data.color); // Applies the color tint
            }
          });
        });
      }
    });
  </script>
  </head>

  <body style="margin: 0px; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; smooth: true; smoothCount: 10; patternRatio: 0.7;"">
      
      <a-entity light="type: ambient; intensity: 1.5;"></a-entity>

      <a-marker type="pattern" url="https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/pattern-opening.patt">
        <a-entity gltf-model="url(https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/window.glb)" 
                  scale="10 10 10" 
                  position="0 5 0" 
                  rotation="90 0 0"
                  architect-filters="color: #00ffff; opacity: 0.6"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/pattern-illum.patt">
        <a-entity gltf-model="url(https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/cone.glb)" 
                  scale="10 10 10" 
                  position="0 0 0"
                  architect-filters="color: #ffff00; opacity: 0.4"></a-entity>
      </a-marker>

      <a-marker type="pattern" url="https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/pattern-connect.patt">
        <a-entity gltf-model="url(https://raw.githubusercontent.com/an3732me-s-ship-it/multiple_patterns_test/refs/heads/main/stair.glb)" 
                  scale="10 10 10" 
                  position="0 0 0" 
                  architect-filters="color: #008000; opacity: 0.8"></a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
